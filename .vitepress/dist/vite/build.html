<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vite build | patak</title>
    <meta name="description" content="patak's home">
    <meta name="generator" content="VitePress v1.0.0-rc.40">
    <link rel="preload stylesheet" href="/assets/style.3ly5dQz3.css" as="style">
    
    <script type="module" src="/assets/app.qyNeOVIl.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.bqR4XwKe.js">
    <link rel="modulepreload" href="/assets/chunks/theme.RssSNRJT.js">
    <link rel="modulepreload" href="/assets/vite_build.md.Zt_O-KJj.lean.js">
    <link rel="icon" type="image/png" href="/images/patak-icon.png">
    <link rel="me" href="https://m.webtoo.ls/@patak">
    <meta name="twitter:site" content="@patak-dev">
    <meta name="theme-color" content="#7eaf90">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <meta property="og:type" content="website">
    <meta property="og:title" content="vite build">
    <meta property="og:image" content="https://www.patak.dev/images/vite-build-cover.jpg">
    <meta property="og:url" content="https://www.patak.dev/vite/build.html">
    <meta property="og:description" content="A walkthrough of the Vite codebase to understand how Vite bundles and optimize your code for production">
    <meta name="twitter:card" content="summary_large_image">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-be30fe8f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-dbd958af></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-dbd958af> Skip to content </a><!--]--><!----><header class="VPNav" data-v-be30fe8f data-v-9d33764e><div class="VPNavBar" data-v-9d33764e data-v-9af6ad0e><div class="wrapper" data-v-9af6ad0e><div class="container" data-v-9af6ad0e><div class="title" data-v-9af6ad0e><div class="VPNavBarTitle" data-v-9af6ad0e data-v-b490fd71><a class="title" href="/" data-v-b490fd71><!--[--><!--]--><!----><!--[-->patak<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-9af6ad0e><div class="content-body" data-v-9af6ad0e><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9af6ad0e><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9af6ad0e data-v-a20f2e0b><span id="main-nav-aria-label" class="visually-hidden" data-v-a20f2e0b>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog.html" tabindex="0" data-v-a20f2e0b data-v-26ef0802><!--[--><span data-v-26ef0802>Blog</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9af6ad0e data-v-34436951><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-34436951 data-v-aceb99e9 data-v-59a1aff1><span class="check" data-v-59a1aff1><span class="icon" data-v-59a1aff1><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-aceb99e9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-aceb99e9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9af6ad0e data-v-d987168e data-v-b24637dc><!--[--><a class="VPSocialLink no-icon" href="https://github.com/patak-dev" aria-label="github" target="_blank" rel="noopener" data-v-b24637dc data-v-91887f2d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://twitter.com/patak_dev" aria-label="twitter" target="_blank" rel="noopener" data-v-b24637dc data-v-91887f2d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M21.543 7.104c.015.211.015.423.015.636 0 6.507-4.954 14.01-14.01 14.01v-.003A13.94 13.94 0 0 1 0 19.539a9.88 9.88 0 0 0 7.287-2.041 4.93 4.93 0 0 1-4.6-3.42 4.916 4.916 0 0 0 2.223-.084A4.926 4.926 0 0 1 .96 9.167v-.062a4.887 4.887 0 0 0 2.235.616A4.928 4.928 0 0 1 1.67 3.148 13.98 13.98 0 0 0 11.82 8.292a4.929 4.929 0 0 1 8.39-4.49 9.868 9.868 0 0 0 3.128-1.196 4.941 4.941 0 0 1-2.165 2.724A9.828 9.828 0 0 0 24 4.555a10.019 10.019 0 0 1-2.457 2.549z"/></svg></a><a class="VPSocialLink no-icon" href="https://m.webtoo.ls/@patak" aria-label="mastodon" target="_blank" rel="noopener" data-v-b24637dc data-v-91887f2d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9af6ad0e data-v-1ffa50d0 data-v-1a07a9c9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-1a07a9c9><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-1a07a9c9><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-1a07a9c9><div class="VPMenu" data-v-1a07a9c9 data-v-c14f2bb5><!----><!--[--><!--[--><!----><div class="group" data-v-1ffa50d0><div class="item appearance" data-v-1ffa50d0><p class="label" data-v-1ffa50d0>Appearance</p><div class="appearance-action" data-v-1ffa50d0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-1ffa50d0 data-v-aceb99e9 data-v-59a1aff1><span class="check" data-v-59a1aff1><span class="icon" data-v-59a1aff1><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-aceb99e9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-aceb99e9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-1ffa50d0><div class="item social-links" data-v-1ffa50d0><div class="VPSocialLinks social-links-list" data-v-1ffa50d0 data-v-b24637dc><!--[--><a class="VPSocialLink no-icon" href="https://github.com/patak-dev" aria-label="github" target="_blank" rel="noopener" data-v-b24637dc data-v-91887f2d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://twitter.com/patak_dev" aria-label="twitter" target="_blank" rel="noopener" data-v-b24637dc data-v-91887f2d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M21.543 7.104c.015.211.015.423.015.636 0 6.507-4.954 14.01-14.01 14.01v-.003A13.94 13.94 0 0 1 0 19.539a9.88 9.88 0 0 0 7.287-2.041 4.93 4.93 0 0 1-4.6-3.42 4.916 4.916 0 0 0 2.223-.084A4.926 4.926 0 0 1 .96 9.167v-.062a4.887 4.887 0 0 0 2.235.616A4.928 4.928 0 0 1 1.67 3.148 13.98 13.98 0 0 0 11.82 8.292a4.929 4.929 0 0 1 8.39-4.49 9.868 9.868 0 0 0 3.128-1.196 4.941 4.941 0 0 1-2.165 2.724A9.828 9.828 0 0 0 24 4.555a10.019 10.019 0 0 1-2.457 2.549z"/></svg></a><a class="VPSocialLink no-icon" href="https://m.webtoo.ls/@patak" aria-label="mastodon" target="_blank" rel="noopener" data-v-b24637dc data-v-91887f2d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9af6ad0e data-v-697edc32><span class="container" data-v-697edc32><span class="top" data-v-697edc32></span><span class="middle" data-v-697edc32></span><span class="bottom" data-v-697edc32></span></span></button></div></div></div></div><div class="divider" data-v-9af6ad0e><div class="divider-line" data-v-9af6ad0e></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-be30fe8f data-v-d7fee107><div class="container" data-v-d7fee107><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-d7fee107 data-v-042d2c29><button data-v-042d2c29>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-be30fe8f data-v-126d408c><div class="VPDoc has-aside" data-v-126d408c data-v-52e7dc14><!--[--><!--]--><div class="container" data-v-52e7dc14><div class="aside" data-v-52e7dc14><div class="aside-curtain" data-v-52e7dc14></div><div class="aside-container" data-v-52e7dc14><div class="aside-content" data-v-52e7dc14><div class="VPDocAside" data-v-52e7dc14 data-v-1d88473e><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-1d88473e data-v-5ab9d1cd><div class="content" data-v-5ab9d1cd><div class="outline-marker" data-v-5ab9d1cd></div><div class="outline-title" role="heading" aria-level="2" data-v-5ab9d1cd>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-5ab9d1cd><span class="visually-hidden" id="doc-outline-aria-label" data-v-5ab9d1cd> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-5ab9d1cd data-v-cb89e7b0><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-1d88473e></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-52e7dc14><div class="content-container" data-v-52e7dc14><!--[--><!--]--><main class="main" data-v-52e7dc14><div style="position:relative;" class="vp-doc _vite_build" data-v-52e7dc14><div><img src="/images/vite-build-cover.jpg" data-v-dfe28062><h1 id="vite-build" tabindex="-1">vite build <a class="header-anchor" href="#vite-build" aria-label="Permalink to &quot;vite build&quot;">​</a></h1><p>The focus when talking about <a href="https://vitejs.dev/" target="_blank" rel="noreferrer">Vite</a> is generally on its dev server, and how it achieves an instant feedback loop while developing. This new unbundled world is a <a href="./../web/vite-2.html">game-changer for DX</a>. But Vite also shines when building your app for production. Vite&#39;s strong focus in giving you an out-of-the-box solution to build optimized modern apps is as fundamental as its dev story.</p><p>So, let&#39;s dive into the Vite codebase to learn how Vite builds your code for production. This post should help you understand how the main pieces fits together to optimize your application, bundling and minifying your JS, CSS, and other assets. This is a high-level overview of the process, that can be useful as a starting point in case you want to explore the codebase to get involved and collaborate with the project. We&#39;ll be pointing to the implementation of each feature (as of <a href="https://github.com/vitejs/vite/tree/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0" target="_blank" rel="noreferrer">Vite 2.6.2</a>).</p><h2 id="warming-up" tabindex="-1">Warming Up <a class="header-anchor" href="#warming-up" aria-label="Permalink to &quot;Warming Up&quot;">​</a></h2><p>This post assumes that you have some previous knowledge of <a href="https://vitejs.dev" target="_blank" rel="noreferrer">Vite</a>. You should at least read the <a href="https://vitejs.dev/guide/why.html" target="_blank" rel="noreferrer">Why Vite Guide</a> from the docs. <a href="https://twitter.com/youyuxi" target="_blank" rel="noreferrer">Evan You</a> did a great demo of Vite in <a href="https://www.youtube.com/watch?v=UJypSr8IhKY" target="_blank" rel="noreferrer">Open Source Friday</a> that is a good way to understand the main concepts. You should also read the <a href="https://vitejs.dev/guide/features.html" target="_blank" rel="noreferrer">Features Guide in Vite&#39;s docs</a>. This post describes the internal plugins implementing these features. It is also a good idea to read the <a href="https://rollupjs.org/guide/en/#plugin-development" target="_blank" rel="noreferrer">Rollup Plugin Development docs</a> and the <a href="https://vitejs.dev/guide/api-plugin.html" target="_blank" rel="noreferrer">Vite Plugin API Guide</a> if you want to dive into the codebase.</p><p>We are going to explore the default build mode targeting modern browsers. To support legacy browsers, Vite offers <a href="https://github.com/vitejs/vite/tree/main/packages/plugin-legacy" target="_blank" rel="noreferrer">@vite_js/plugin-legacy</a>. Vite can also be used to <a href="https://vitejs.dev/guide/build.html#library-mode" target="_blank" rel="noreferrer">build libraries</a> and <a href="https://vitejs.dev/guide/build.html#rebuild-on-files-changes" target="_blank" rel="noreferrer">watch mode</a>. You can learn more about the different build options in the <a href="https://vitejs.dev/guide/build.html" target="_blank" rel="noreferrer">Build Guide</a>.</p><p>It is a good idea to scaffold a simple Vite app (run <code>pnpm dlx create-vite</code> and follow the prompts or read the <a href="https://vitejs.dev/guide/#scaffolding-your-first-vite-project" target="_blank" rel="noreferrer">Getting Started Guide</a> for other package managers). I recommend you install <a href="https://twitter.com/antfu7" target="_blank" rel="noreferrer">Anthony Fu</a>&#39;s <a href="https://github.com/antfu/vite-plugin-inspect" target="_blank" rel="noreferrer">vite-plugin-inspect</a>. This plugin is more useful during dev, but a lot of the transformations are shared in dev and build so you can use it to see how some of Vite&#39;s internal plugins are changing your code.</p><h2 id="the-big-picture" tabindex="-1">The Big Picture <a class="header-anchor" href="#the-big-picture" aria-label="Permalink to &quot;The Big Picture&quot;">​</a></h2><p>Let&#39;s first review what it means to build an app. In Vite, it all starts with the HTML entry (an <code>index.html</code> at the root by default). This HTML file has script module tags and linked stylesheets.</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;!</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">DOCTYPE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;module&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/src/main.ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line highlighted"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // inline script</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">link</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;stylesheet&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> href</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/src/main.css&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      internal-style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>We need to crawl the HTML file to find each loaded JS module, inline script tags, and linked CSS stylesheets. JS sources go through the normal rollup bundling process resolving and transforming internal dependencies to generate a <code>vendor.js</code> bundle (with dependencies that are not regularly updated) and an <code>index.js</code> bundle (with the rest of our app). These output chunks need to be hashed to enable strong caching. Linked stylesheets will also be bundled together with any imported CSS file from JS sources in the main chunk to generate an index.css file for our app. Internal styles are left untouched.</p><p>Script tags or imports could point to typescript files or other file types, as long as Vite knows how to transpile them or it is extended with user plugins to deal with them. In the case above, the <code>main.ts</code> file needs to be transformed to a JS file as part of the bundling process. In Vite, this is supported out of the box by using <a href="https://esbuild.github.io/" target="_blank" rel="noreferrer">esbuild</a>, a Go based bundler.</p><p>Once we have created the JS and CSS assets for the build, we replace the original script and link tags with them to create the output <code>index.html</code> file for our app. Vite performs static analysis of imports to inject module preload link tags for each JS source that will be needed, allowing the browser to load these resources in parallel thus avoiding a loading waterfall.</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;!</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">DOCTYPE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;module&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/assets/index.d93758c6.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">link</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;modulepreload&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> href</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/assets/vendor.a9c538d6.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">link</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;stylesheet&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> href</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/assets/index.3015a40c.css&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      internal-style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>Vite supports code splitting, both JS and CSS assets. When a dynamic import is encountered, an async JS chunk and a CSS chunk are generated for it. The import call is then instrumented in the importer chunk to preload its dependencies and wait for the corresponding CSS stylesheet.</p><p>Other assets like images, videos, wasm can be imported using relative paths. Vite also hashes these files when generating their output asset file and rewrites the URLs in JS and CSS files to point to them. On the other hand, assets on the public folder are copied as-is to the output root, and allow users to reference these files by stable absolute paths.</p><p>Each JS and CSS chunk needs to be minified for production. Vite also uses esbuild for this task for both languages since <a href="https://github.com/vitejs/vite/blob/main/packages/vite/CHANGELOG.md#260-2021-09-29" target="_blank" rel="noreferrer">Vite 2.6.0</a>, helping speed up the build process.</p><p>Now that we have an overview of the build process centered around the entry HTML file, let&#39;s dig into the details. Vite performs further optimizations and supports common web patterns by default, we&#39;ll check how these are implemented in the next sections.</p><h2 id="an-opinionated-rollup-setup" tabindex="-1">An Opinionated Rollup Setup <a class="header-anchor" href="#an-opinionated-rollup-setup" aria-label="Permalink to &quot;An Opinionated Rollup Setup&quot;">​</a></h2><p>At build time, you can think of Vite as an opinionated <a href="https://rollupjs.org/" target="_blank" rel="noreferrer">Rollup</a> setup. The <a href="https://rollupjs.org/guide/en/#plugin-development" target="_blank" rel="noreferrer">Rollup plugins API</a> allows Vite to support most out-of-the-box features as independent plugins. Vite uses an <a href="https://vitejs.dev/guide/api-plugin.html" target="_blank" rel="noreferrer">extension of this plugin API</a>, introducing <a href="https://vitejs.dev/guide/api-plugin.html#vite-specific-hooks" target="_blank" rel="noreferrer">new hooks</a> that allows to better configure Vite (<code>config</code>, <code>configResolved</code>), transform the HTML entry (<code>transformIndexHtml</code>), and extend development mode (<code>configureServer</code>, <code>handleHotUpdate</code>). There are a few <a href="https://vitejs.dev/guide/api-plugin.html#rollup-plugin-compatibility" target="_blank" rel="noreferrer">compatibility caveats with Rollup plugins</a> to take into account, but most plugins from the rollup ecosystem <a href="https://vite-rollup-plugins.patak.dev/" target="_blank" rel="noreferrer">will work directly as a Vite plugin</a>. Since we are focusing on build time, these extra hooks won&#39;t come into play. We don&#39;t have the Vite server, or HMR logic. Vite configures rollup, reusing the feature plugins that run during dev (support for JSON, wasm, workers, etc), and adds other plugins to optimize your code (minification, preloading, etc).</p><p>As we saw in the previous section, <a href="https://esbuild.github.io/" target="_blank" rel="noreferrer">esbuild</a> is used to transpile individual files (to strip typescript types and compile JSX) and as the default minifier. esbuild is also used as a bundler when pre-bundling dependencies, but this is a dev-only process. This may change in the future, there is a <a href="https://github.com/vitejs/vite/discussions/4921#discussion-3569543" target="_blank" rel="noreferrer">proposal</a> to use esbuild pre-bundle dependencies also for production, aliasing dependencies to these chunks during the Rollup build phase.</p><br><p><img src="/images/vite-build.svg" alt="Vite build stages"></p><h2 id="starting-from-the-cli" tabindex="-1">Starting from the CLI <a class="header-anchor" href="#starting-from-the-cli" aria-label="Permalink to &quot;Starting from the CLI&quot;">​</a></h2><p>When you execute <code>vite build</code>, the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/bin/vite.js#L42" target="_blank" rel="noreferrer">Vite CLI</a> is run. The <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/cli.ts#L128" target="_blank" rel="noreferrer">run command</a> is implemented using <a href="https://github.com/cacjs/cac#readme" target="_blank" rel="noreferrer">cac</a>. The action runs the <a href="https://vitejs.dev/guide/api-javascript.html#build" target="_blank" rel="noreferrer">public <code>build</code> function</a></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ root, base, mode, config, logLevel, clearScreen, buildOptions })</span></span></code></pre></div><p>This function calls into <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/build.ts#L346" target="_blank" rel="noreferrer"><code>doBuild</code></a>. Here is a simplified version of the implementation, assuming defaults are used so the logic related to SSR, lib mode, and <code>build --watch</code> can be removed.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> doBuild</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">inlineConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InlineConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {})</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RollupOutput</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> resolveConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inlineConfig, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;build&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;production&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> outDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config.build.outDir)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  prepareOutDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(outDir, config)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bundle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rollup.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rollup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    input: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;index.html&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    plugins: config.plugins</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bundle.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dir: outDir,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    format: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;es&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    exports: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;auto&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sourcemap: config.build.sourcemap,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    entryFileNames: path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config.assetsDir, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`[name].[hash].js`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    chunkFileNames: path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config.assetsDir, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`[name].[hash].js`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    assetFileNames: path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config.assetsDir, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`[name].[hash].[ext]`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    manualChunks: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createMoveToVendorChunkFn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>First, <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/config.ts#L241" target="_blank" rel="noreferrer"><code>resolveConfig</code></a> is used to generate a <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/config.ts#L420" target="_blank" rel="noreferrer">concrete <code>ResolvedConfig</code></a> by resolving the user config, the project config files and Vite defaults. See <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/config.ts#L206" target="_blank" rel="noreferrer"><code>ResolvedConfig</code> declaration</a>, that extends <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/config.ts#L69" target="_blank" rel="noreferrer"><code>UserConfig</code></a>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> resolveConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inlineConfig, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;build&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;production&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> outDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config.build.outDir)</span></span></code></pre></div><p>Next, the <a href="https://github.com/vitejs/vite/blob/6011665ca23a41cb7643d44c539bc03d4155e43f/packages/vite/src/node/build.ts#L561" target="_blank" rel="noreferrer">output dir is prepared</a>, emptying it before generating the assets. This function also adds support for the <a href="https://vitejs.dev/guide/assets.html#the-public-directory" target="_blank" rel="noreferrer">public directory</a> feature, copying the content of <code>publicDir</code> to the root of our dist folder.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  prepareOutDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(outDir, config)</span></span></code></pre></div><p>Then, <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/build.ts#L531" target="_blank" rel="noreferrer">a rollup bundle is created</a> with the <code>index.html</code> as input, and <a href="#the-plugins-pipeline">the resolved plugins</a>. You can see <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/build.ts#L409" target="_blank" rel="noreferrer">the complete rollup options resolving</a>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bundle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rollup.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rollup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    input: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;index.html&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    plugins: config.plugins</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span></code></pre></div><p>Finally, <code>bundle.write</code> is called to generate the assets in the output directory. You can check the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/build.ts#L438" target="_blank" rel="noreferrer">complete write config object</a>. In the snippets, we showcase the most important options assuming default values are used.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bundle.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dir: outDir,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    format: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;es&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    exports: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;auto&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sourcemap: config.build.sourcemap,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    entryFileNames: path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(options.assetsDir, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`[name].[hash].js`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    chunkFileNames: path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(options.assetsDir, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`[name].[hash].js`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    assetFileNames: path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(options.assetsDir, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`[name].[hash].[ext]`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    manualChunks: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createMoveToVendorChunkFn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span></code></pre></div><p>The <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/build.ts#L593" target="_blank" rel="noreferrer"><code>createMoveToVendorChunkFn</code></a> function defines the default chunking strategy (that generates <code>index.js</code> and <code>vendor.js</code> assets for the build).</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createMoveToVendorChunkFn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">getModuleInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      id.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node_modules&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isCSSRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      staticImportedByEntry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id, getModuleInfo)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vendor&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>As we can see, the core of the build process is a Rollup setup with carefully selected defaults for Vite&#39;s target use case. The logic is a bit more complex in the codebase to support lib mode, SSR builds, and <code>build --watch</code>. This is just the beginning of the story though, all the features and optimizations are implemented as Rollup plugins.</p><h2 id="the-plugins-pipeline" tabindex="-1">The Plugins Pipeline <a class="header-anchor" href="#the-plugins-pipeline" aria-label="Permalink to &quot;The Plugins Pipeline&quot;">​</a></h2><p>Plugins are resolved during dev and build time in <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/index.ts#L18" target="_blank" rel="noreferrer"><code>resolvedPlugins</code></a>. Vite inserts extra build plugins when building to handle minification and other optimizations using <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/build.ts#L290" target="_blank" rel="noreferrer"><code>resolveBuildPlugins</code></a>. Apart from dev only or build only plugins, some plugins implement conditional logic depending on the current command. See for example, how <a href="https://github.com/vitejs/vite/blob/72cb33e947e7aa72d27ed0c5eacb2457d523dfbf/packages/vite/src/node/plugins/css.ts#L284" target="_blank" rel="noreferrer"><code>config.command === &#39;serve&#39;</code> is used</a> in the <a href="#_6-vite-css"><code>vite:css</code></a> plugin.</p><p>There are a few key plugins. <a href="#_15-vite-build-html"><code>vite:build-html</code></a> and <a href="#_5-vite-html-inline-proxy-plugin"><code>vite:html-inline-proxy-plugin</code></a> to transform the HTML entry, replacing your loaded and inlined JS and CSS with optimized chunks. <a href="#_6-vite-css"><code>vite:css</code></a> and <a href="#_14-vite-css-post"><code>vite:css-post</code></a> to handle CSS and preprocessors. <a href="#_7-vite-esbuild"><code>vite:esbuild</code></a> to transpile Typescript and JSX for each module. <a href="#_11-vite-asset"><code>vite:asset</code></a> to manage static assets. <a href="#_vite-build-import-analysis"><code>vite:build-import-analysis</code></a> for preloading optimizations, glob import support, and URL rewriting. <a href="#_vite-esbuild-transpile"><code>vite:esbuild-transpile</code></a> to transpile the chunks to the appropriate target and minify your code. Most plugins implement their features in isolation, but there are some cases where the responsibility is shared between a few of them working together.</p><p>The rest of the plugins implement further optimizations, improve <a href="#_3-vite-modulepreload-polyfill">compatibility</a> and adds support for common Web patterns (like importing <a href="#_8-vite-json">JSON</a>, <a href="#_9-vite-wasm">Wasm</a>, or <a href="#_10-vite-worker">Worker Modules</a>).</p><p>Some of these plugins are <a href="https://github.com/rollup/plugins" target="_blank" rel="noreferrer">official Rollup Plugins</a> (<a href="#_1-alias"><code>alias</code></a>, <a href="#_16-commonjs"><code>commonjs</code></a>, <a href="#_18-rollup-plugin-dynamic-import-variables"><code>rollup-plugin-dynamic-import-variables</code></a>). Some are similar in functionality to other official Rollup plugins but have been reimplemented to better match Vite&#39;s API or to be able to include a different behavior during dev using Vite&#39;s extended plugin API.</p><h2 id="plugins-walkthrough" tabindex="-1">Plugins Walkthrough <a class="header-anchor" href="#plugins-walkthrough" aria-label="Permalink to &quot;Plugins Walkthrough&quot;">​</a></h2><p>Let&#39;s dive into each of the plugins to learn about their responsibilities. We&#39;ll include links to their implementation and the relevant sections in the docs.</p><p>When a plugin needs to define a cache or generate data to be consumed later in the pipeline, this is usually implemented as <code>WeakMap</code> based caches keyed with the <code>ResolvedConfig</code> of the current run. These caches are re-init in the <a href="https://rollupjs.org/guide/en/#buildstart" target="_blank" rel="noreferrer"><code>buildStart</code> hook</a> (<a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L267" target="_blank" rel="noreferrer">see example</a>) to support <code>build --watch</code> mode.</p><p>Users can control the application order of a plugin using the <a href="https://vitejs.dev/guide/api-plugin.html#plugin-ordering" target="_blank" rel="noreferrer"><code>enforce</code>property</a>. You can also see where the <code>pre</code> and <code>post</code> plugins <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/index.ts#L33" target="_blank" rel="noreferrer">are inserted</a> in the final plugins array.</p><ul><li>Alias</li><li>... User pre plugins (with <code>enforce: &#39;pre&#39;</code>)</li><li>Vite core plugins</li><li>... User normal plugins (without <code>enforce</code>)</li><li>Vite build plugins</li><li>... User post plugins (with <code>enforce: &#39;post&#39;</code>)</li><li>Vite post build plugins</li></ul><p>The plugins for a default configuration of a Vite build run are:</p><ul><li><a href="#vite-build">vite build</a><ul><li><a href="#warming-up">Warming Up</a></li><li><a href="#the-big-picture">The Big Picture</a></li><li><a href="#an-opinionated-rollup-setup">An Opinionated Rollup Setup</a></li><li><a href="#starting-from-the-cli">Starting from the CLI</a></li><li><a href="#the-plugins-pipeline">The Plugins Pipeline</a></li><li><a href="#plugins-walkthrough">Plugins Walkthrough</a><ul><li><a href="#1-alias">1. <code>alias</code></a></li><li><a href="#2--user-pre-plugins">2. <code>... user pre plugins</code></a></li><li><a href="#3-vitemodulepreload-polyfill">3. <code>vite:modulepreload-polyfill</code></a></li><li><a href="#4-viteresolve">4. <code>vite:resolve</code></a></li><li><a href="#5-vitehtml-inline-proxy-plugin">5. <code>vite:html-inline-proxy-plugin</code></a></li><li><a href="#6-vitecss">6. <code>vite:css</code></a></li><li><a href="#7-viteesbuild">7. <code>vite:esbuild</code></a></li><li><a href="#8-vitejson">8. <code>vite:json</code></a></li><li><a href="#9-vitewasm">9. <code>vite:wasm</code></a></li><li><a href="#10-viteworker">10. <code>&#39;vite:worker&#39;</code></a></li><li><a href="#11-viteasset">11. <code>&#39;vite:asset&#39;</code></a></li><li><a href="#12--user-normal-plugins">12. <code>... user normal plugins</code></a></li><li><a href="#13-vitedefine">13. <code>vite:define</code></a></li><li><a href="#14-vitecss-post">14. <code>vite:css-post</code></a></li><li><a href="#15-vitebuild-html">15. <code>vite:build-html</code></a></li><li><a href="#16-commonjs">16. <code>commonjs</code></a></li><li><a href="#17-vitedata-uri">17. <code>&#39;vite:data-uri&#39;</code></a></li><li><a href="#18-rollup-plugin-dynamic-import-variables">18. <code>rollup-plugin-dynamic-import-variables</code></a></li><li><a href="#19-viteasset-import-meta-url">19. <code>vite:asset-import-meta-url</code></a></li><li><a href="#20--user-post-plugins">20. <code>... user post plugins</code></a></li><li><a href="#21-vitebuild-import-analysis">21. <code>vite:build-import-analysis</code></a></li><li><a href="#22-viteesbuild-transpile">22. <code>vite:esbuild-transpile</code></a></li><li><a href="#23-viteterser">23. <code>vite:terser</code></a></li><li><a href="#24-vitemanifest">24. <code>vite:manifest</code></a></li><li><a href="#25-vitessr-manifest">25. <code>vite:ssr-manifest</code></a></li><li><a href="#26-vitereporter">26. <code>vite:reporter</code></a></li><li><a href="#27-viteload-fallback">27. <code>vite:load-fallback</code></a></li></ul></li><li><a href="#the-vite-ecosystem">The Vite ecosystem</a></li><li><a href="#closing-thoughts">Closing Thoughts</a></li></ul></li></ul><h3 id="_1-alias" tabindex="-1">1. <code>alias</code> <a class="header-anchor" href="#_1-alias" aria-label="Permalink to &quot;1. `alias`&quot;">​</a></h3><p>This is the official <a href="https://github.com/rollup/plugins/tree/master/packages/alias#rollupplugin-alias" target="_blank" rel="noreferrer">@rollup/plugin-alias</a>, called as <code>aliasPlugin({ entries: config.resolve.alias })</code>. See Vite docs for <a href="https://vitejs.dev/config/#resolve-alias" target="_blank" rel="noreferrer"><code>resolve.alias</code></a>. This is a plugin for defining aliases when bundling packages, same as <a href="https://webpack.js.org/configuration/resolve/#resolvealias" target="_blank" rel="noreferrer"><code>resolve.alias</code></a> in Webpack. Configuring Vite with</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  alias</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/@components&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(__dirname, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;src/components&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Lets you write your imports from anywhere in your source as</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Button </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/@components/Button.vue&#39;</span></span></code></pre></div><p>This plugin then resolves the path and transpile them to the real path</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Button </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../../components/Button.vue&#39;</span></span></code></pre></div><h3 id="_2-user-pre-plugins" tabindex="-1">2. <code>... user pre plugins</code> <a class="header-anchor" href="#_2-user-pre-plugins" aria-label="Permalink to &quot;2. `... user pre plugins`&quot;">​</a></h3><p>These are the plugins with <a href="https://vitejs.dev/guide/api-plugin.html#plugin-ordering" target="_blank" rel="noreferrer"><code>enforce: &#39;pre&#39;</code></a>. For example, the <a href="https://vite-rollup-plugins.patak.dev/#image" target="_blank" rel="noreferrer"><code>@rollup/plugin-image</code></a> requires this flag so it is applied before Vite asset handling internal plugins.</p><h3 id="_3-vite-modulepreload-polyfill" tabindex="-1">3. <code>vite:modulepreload-polyfill</code> <a class="header-anchor" href="#_3-vite-modulepreload-polyfill" aria-label="Permalink to &quot;3. `vite:modulepreload-polyfill`&quot;">​</a></h3><p>This plugin adapts the module preload polyfill from <a href="https://github.com/guybedford/es-module-shims" target="_blank" rel="noreferrer">guybedford/es-module-shims</a>. You can see more details in <a href="https://guybedford.com/es-module-preloading-integrity" target="_blank" rel="noreferrer">ES Module Preloading &amp; Integrity</a>. This polyfill allows Vite to <a href="https://vitejs.dev/guide/features.html#preload-directives-generation" target="_blank" rel="noreferrer">preload modules</a> to avoid a loading waterfall, supporting non-chromium browsers. See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/modulePreloadPolyfill.ts#L7" target="_blank" rel="noreferrer"><code>modulePreloadPolyfillPlugin</code> implementation</a>. The import for <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/html.ts#L296" target="_blank" rel="noreferrer">the polyfill is auto-injected</a> if needed while transforming the html in <a href="#_15-vite-build-html"><code>vite:build-html</code></a>.</p><h3 id="_4-vite-resolve" tabindex="-1">4. <code>vite:resolve</code> <a class="header-anchor" href="#_4-vite-resolve" aria-label="Permalink to &quot;4. `vite:resolve`&quot;">​</a></h3><p>This plugin serves a similar purpose to <a href="https://github.com/rollup/plugins/tree/master/packages/node-resolve" target="_blank" rel="noreferrer"><code>@rollup/plugin-node-resolve</code></a>. It locates modules using the <a href="https://nodejs.org/api/modules.html#modules_all_together" target="_blank" rel="noreferrer">Node resolution algorithm</a>, for using third party modules in <code>node_modules</code>. It is different from the official rollup plugin because of the need for special handling for Vite-specific features (SSR and dev server). You can see <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/resolve.ts#L69" target="_blank" rel="noreferrer"><code>resolvePlugin</code> implementation here</a>. There is quite a bit of complexity in this plugin to replicate the way Node resolve files.</p><h3 id="_5-vite-html-inline-proxy-plugin" tabindex="-1">5. <code>vite:html-inline-proxy-plugin</code> <a class="header-anchor" href="#_5-vite-html-inline-proxy-plugin" aria-label="Permalink to &quot;5. `vite:html-inline-proxy-plugin`&quot;">​</a></h3><p>This plugin loads inline scripts of entry HTML files as separate modules. These scripts are removed from the HTML source by the <a href="#_15-vite-build-html"><code>vite:build-html</code></a> plugin and replaced with a script module tag pointing to a virtual proxy module identified by a suffix and its position in the HTML <code>?html-proxy&amp;index={n}</code>. This allows these modules to be processed by the rollup pipeline and bundled with the rest of the imported modules. See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/html.ts#L38" target="_blank" rel="noreferrer"><code>htmlInlineScriptProxyPlugin</code> implementation</a>.</p><h3 id="_6-vite-css" tabindex="-1">6. <code>vite:css</code> <a class="header-anchor" href="#_6-vite-css" aria-label="Permalink to &quot;6. `vite:css`&quot;">​</a></h3><p>This plugin works together with the <a href="#_14-vite-css-post"><code>vite:css-post</code></a> plugin to implement <a href="https://vitejs.dev/guide/features.html#css" target="_blank" rel="noreferrer">Vite&#39;s CSS features</a>. Support for pre-processors (postCSS, sass, less), including resolving imported URLs. Check out the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L568" target="_blank" rel="noreferrer"><code>compileCSS</code></a> implementation for details. This plugin also record CSS dependencies from <code>@imports</code>. See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L137" target="_blank" rel="noreferrer"><code>cssPlugin</code> implementation</a>.</p><h3 id="_7-vite-esbuild" tabindex="-1">7. <code>vite:esbuild</code> <a class="header-anchor" href="#_7-vite-esbuild" aria-label="Permalink to &quot;7. `vite:esbuild`&quot;">​</a></h3><p>A plugin to transforms <code>.js</code>, <code>.ts</code>, <code>.jsx</code>, and <code>.tsx</code> files with <a href="https://esbuild.github.io/" target="_blank" rel="noreferrer">esbuild</a> to strips the types and compile JSX. This plugin also injects the configured JSX helpers like <code>import React from &#39;react&#39;</code>, see <a href="https://vitejs.dev/guide/features.html#jsx" target="_blank" rel="noreferrer"><code>options.jsxInject</code></a>. Internally uses <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/esbuild.ts#L52" target="_blank" rel="noreferrer">transformWithEsbuild</a>, which is independent of the Vite plugins pipeline and exported as a utility. Several community plugins are also using it internally. See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/esbuild.ts#L164" target="_blank" rel="noreferrer"><code>esbuildPlugin</code> implementation</a>.</p><h3 id="_8-vite-json" tabindex="-1">8. <code>vite:json</code> <a class="header-anchor" href="#_8-vite-json" aria-label="Permalink to &quot;8. `vite:json`&quot;">​</a></h3><p>Handles importing of JSON files, see <a href="https://vitejs.dev/guide/features.html#json" target="_blank" rel="noreferrer">Vite docs for this feature</a>. This is similar to <a href="https://github.com/rollup/plugins/tree/master/packages/json" target="_blank" rel="noreferrer">@rollup/plugin-json</a>, but supports a <code>json.stringify</code> option to further optimize the bundle if named exports are not needed.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// import the entire object</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./example.json&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// or import a root field as named exports, helping with tree shaking</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { field } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./example.json&#39;</span></span></code></pre></div><p>See <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/json.ts#L30" target="_blank" rel="noreferrer"><code>jsonPlugin</code> implementation</a>.</p><h3 id="_9-vite-wasm" tabindex="-1">9. <code>vite:wasm</code> <a class="header-anchor" href="#_9-vite-wasm" aria-label="Permalink to &quot;9. `vite:wasm`&quot;">​</a></h3><p>This plugin allows users to import pre-compiled <code>.wasm</code> files directly. See <a href="https://vitejs.dev/guide/features.html#webassembly" target="_blank" rel="noreferrer">WebAssembly docs</a>. This is similar to <a href="https://github.com/rollup/plugins/tree/master/packages/wasm" target="_blank" rel="noreferrer">@rollup/plugin-wasm</a> but uses a slightly different API. The async constructor returns the <code>exports</code> object directly instead of an <code>instance</code> object with an <code>exports</code> member.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> init </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./example.wasm&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><p>See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/wasm.ts#L45" target="_blank" rel="noreferrer"><code>wasmPlugin</code> implementation</a>.</p><h3 id="_10-vite-worker" tabindex="-1">10. <code>&#39;vite:worker&#39;</code> <a class="header-anchor" href="#_10-vite-worker" aria-label="Permalink to &quot;10. `&#39;vite:worker&#39;`&quot;">​</a></h3><p>This plugin adds support for creating Web Workers by importing them. See the <a href="https://vitejs.dev/guide/features.html#web-workers" target="_blank" rel="noreferrer">Worker docs</a>. The plugin uses rollup to bundle the workers so regular workers can be used, as Firefox doesn&#39;t support module workers at this point. This bundle can also be <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/worker.ts#L76" target="_blank" rel="noreferrer">inlined</a> using the <code>&amp;inline</code> suffix.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MyWorker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./my-worker.js?worker&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyWorker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><p>See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/worker.ts#L22" target="_blank" rel="noreferrer"><code>webWorkerPlugin</code> implementation</a>.</p><h3 id="_11-vite-asset" tabindex="-1">11. <code>&#39;vite:asset&#39;</code> <a class="header-anchor" href="#_11-vite-asset" aria-label="Permalink to &quot;11. `&#39;vite:asset&#39;`&quot;">​</a></h3><p>This plugin implements <a href="https://vitejs.dev/guide/assets.html" target="_blank" rel="noreferrer">Vite&#39;s Assets handling</a>. For example, importing a static asset returns the resolved public URL including its hash. In production, this plugin resolves <code>imgUrl</code> to a string. In the example below, it could be <code>&#39;/assets/img.2d8efhg.png&#39;</code>.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> imgUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./img.png&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hero-img&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> imgUrl</span></span></code></pre></div><p>In <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/asset.ts#L85" target="_blank" rel="noreferrer"><code>renderChunk</code></a>, the assets URL are overwritten to their public path in the dist folder.</p><p>Vite uses suffixes to <a href="https://vitejs.dev/guide/assets.html#explicit-url-imports" target="_blank" rel="noreferrer">explicitly import URLs (<code>?url</code>)</a> and <a href="https://vitejs.dev/guide/assets.html#importing-asset-as-string" target="_blank" rel="noreferrer">import asset as strings (<code>?raw</code>)</a>, and these features are also resolved in by this plugin. See implementation for <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/asset.ts#L80" target="_blank" rel="noreferrer">?url</a> and <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/asset.ts#L67" target="_blank" rel="noreferrer">?raw</a> handling.</p><p>See the complete <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/asset.ts#L37" target="_blank" rel="noreferrer"><code>assetPlugin</code> implementation</a>.</p><h3 id="_12-user-normal-plugins" tabindex="-1">12. <code>... user normal plugins</code> <a class="header-anchor" href="#_12-user-normal-plugins" aria-label="Permalink to &quot;12. `... user normal plugins`&quot;">​</a></h3><p>Plugins without an <code>enforce</code> flag.</p><h3 id="_13-vite-define" tabindex="-1">13. <code>vite:define</code> <a class="header-anchor" href="#_13-vite-define" aria-label="Permalink to &quot;13. `vite:define`&quot;">​</a></h3><p>A plugin to define global constant replacements, equivalent to the official <a href="https://github.com/rollup/plugins/tree/master/packages/replace" target="_blank" rel="noreferrer">@rollup/plugin-replace</a>. Check out the <a href="https://vitejs.dev/config/#define" target="_blank" rel="noreferrer">define docs</a>. Entries will be defined as globals during dev and statically replaced during build. The replacement is regex-based so only constants like <code>__APP_VERSION__</code> should be used or you could end up with replacements inside strings.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">define</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  __APP_VERSION__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`JSON.stringify(${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">})`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/define.ts#L7" target="_blank" rel="noreferrer"><code>definePlugin</code> implementation</a>.</p><h3 id="_14-vite-css-post" tabindex="-1">14. <code>vite:css-post</code> <a class="header-anchor" href="#_14-vite-css-post" aria-label="Permalink to &quot;14. `vite:css-post`&quot;">​</a></h3><p>This plugin <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L315" target="_blank" rel="noreferrer">minifies the bundled CSS chunks with esbuild</a>. See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L905" target="_blank" rel="noreferrer"><code>minifyCSS</code> function</a> for details.</p><p>Asset URL placeholders are <a href="https://github.com/vitejs/vite/blob/e8a1d19670c2d28fe06efb8fade89b045bebb7ef/packages/vite/src/node/plugins/css.ts#L364" target="_blank" rel="noreferrer">resolved to their final build path</a>.</p><p>It also implements <a href="https://vitejs.dev/guide/features.html#css-code-splitting" target="_blank" rel="noreferrer">CSS Code Splitting</a>. For each async chunk, the CSS used by its modules is <a href="https://github.com/vitejs/vite/blob/e8a1d19670c2d28fe06efb8fade89b045bebb7ef/packages/vite/src/node/plugins/css.ts#L344" target="_blank" rel="noreferrer">bundled</a> and extracted in a <a href="https://github.com/vitejs/vite/blob/70e882f06a80bcfb6f5189902984751d9c06cf8f/packages/vite/src/node/plugins/css.ts#L400" target="_blank" rel="noreferrer">separate async chunk</a>, loaded via a <code>&lt;link&gt;</code> tag when needed. This CSS file is guaranteed to be loaded before the async chuck is evaluated, thus avoiding FOUC.</p><p>This is a simplified version of the <a href="https://github.com/vitejs/vite/blob/545b1f13cec069bbae5f37c7540171128f439e7b/packages/vite/src/node/plugins/importAnalysisBuild.ts#L43" target="_blank" rel="noreferrer">preload client helper</a> injected by Vite in the built code.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createLink</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // JS  -&gt; &lt;link rel=&quot;modulepreload&quot; href=&quot;dep&quot; /&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // CSS -&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;dep&quot; /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> preload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">importModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">deps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    deps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dep</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">alreadyLoaded</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dep)) { </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        document.head.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendChild</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createLink</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dep))      </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isCss</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dep)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // Wait for CSS to load to avoid FOUC</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            link.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;load&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, resolve)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            link.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;error&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, reject)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> importModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>This plugin will transform dynamic imports using this helper. The following</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./async.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>will be transpiled into</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">preload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/assets/async.js)</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/assets/async.css&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/assets/async-dep.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>If <a href="https://vitejs.dev/config/#build-csscodesplit" target="_blank" rel="noreferrer"><code>build.cssCodeSplit</code></a> is false, these chunks are injected by the <a href="#_15-vite-build-html"><code>vite:build-html</code></a> plugin <a href="https://github.com/vitejs/vite/blob/70e882f06a80bcfb6f5189902984751d9c06cf8f/packages/vite/src/node/plugins/html.ts#L421" target="_blank" rel="noreferrer">as link tags</a></p><p>See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/css.ts#L254" target="_blank" rel="noreferrer"><code>cssPostPlugin</code> implementation</a>.</p><h3 id="_15-vite-build-html" tabindex="-1">15. <code>vite:build-html</code> <a class="header-anchor" href="#_15-vite-build-html" aria-label="Permalink to &quot;15. `vite:build-html`&quot;">​</a></h3><p>This plugin compiles <code>.html</code> scripts into an entry JS module. It first removes the script tags from the HTML in the <code>transform</code> hook, generating a JS file that imports each module and asset. The JS bundles are later inserted in the <code>generateBundle</code> hook and the assets in the <a href="#_11-vite-asset"><code>vite:asset</code></a> plugin. As described in <a href="#_3-vite-modulepreload-polyfill"><code>vite:modulepreload-polyfill</code></a>, if there is at least one script module in the module, the module preload polyfill will be auto-injected. See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/html.ts#L149" target="_blank" rel="noreferrer"><code>buildHtmlPlugin</code> implementation</a>.</p><h3 id="_16-commonjs" tabindex="-1">16. <code>commonjs</code> <a class="header-anchor" href="#_16-commonjs" aria-label="Permalink to &quot;16. `commonjs`&quot;">​</a></h3><p>This is the official <a href="https://github.com/rollup/plugins/tree/master/packages/commonjs" target="_blank" rel="noreferrer">@rollup/plugin-commonjs</a>, that converts CommonJS modules to ES6 so they can be included in a Rollup bundle. During dev, Vite performs dependencies pre-bundling using esbuild that takes care of converting from CommonJS to ES6, but during build time the pre-bundles are not currently used so the &#39;commonjs&#39; plugin is needed.</p><h3 id="_17-vite-data-uri" tabindex="-1">17. <code>&#39;vite:data-uri&#39;</code> <a class="header-anchor" href="#_17-vite-data-uri" aria-label="Permalink to &quot;17. `&#39;vite:data-uri&#39;`&quot;">​</a></h3><p>A plugin equivalent to <a href="https://github.com/rollup/plugins/tree/master/packages/data-uri" target="_blank" rel="noreferrer">@rollup/plugin-data-uri</a>, which imports modules from <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" target="_blank" rel="noreferrer">Data URIs</a>. For example, Base64 encoding is supported for well-formed <code>data:</code> URIs.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> batman </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;data:application/json;base64, eyAiYmF0bWFuIjogInRydWUiIH0=&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/dataUri.ts#L14" target="_blank" rel="noreferrer"><code>dataURIPlugin</code> implementation</a>.</p><h3 id="_18-rollup-plugin-dynamic-import-variables" tabindex="-1">18. <code>rollup-plugin-dynamic-import-variables</code> <a class="header-anchor" href="#_18-rollup-plugin-dynamic-import-variables" aria-label="Permalink to &quot;18. `rollup-plugin-dynamic-import-variables`&quot;">​</a></h3><p>This is the official <a href="https://github.com/rollup/plugins/tree/master/packages/dynamic-import-vars" target="_blank" rel="noreferrer">@rollup/plugin-dynamic-import-vars</a> plugin, used to support variables in dynamic imports. It is configured with <a href="https://vitejs.dev/config/#build-dynamicimportvarsoptions" target="_blank" rel="noreferrer"><code>build.dynamicImportVarsOptions</code></a>. and allows users to write dynamic resolved imports:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> importLocale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">locale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`./locales/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">locale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}.js`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_19-vite-asset-import-meta-url" tabindex="-1">19. <code>vite:asset-import-meta-url</code> <a class="header-anchor" href="#_19-vite-asset-import-meta-url" aria-label="Permalink to &quot;19. `vite:asset-import-meta-url`&quot;">​</a></h3><p>Convert <code>new URL(path, import.meta.url)</code> to its resolved built URL. Check out the <a href="https://vitejs.dev/guide/assets.html#new-url-url-import-meta-url" target="_blank" rel="noreferrer">docs in Static Asset Handling Guide</a>. It also supports template string with dynamic segments:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`./dir/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}.png`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.url)</span></span></code></pre></div><p>Would be transformed to</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">globEager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./dir/**.png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`./dir/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}.png`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].default</span></span></code></pre></div><p>See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/assetImportMetaUrl.ts#L18" target="_blank" rel="noreferrer"><code>assetImportMetaUrlPlugin</code> implementation</a>.</p><h3 id="_20-user-post-plugins" tabindex="-1">20. <code>... user post plugins</code> <a class="header-anchor" href="#_20-user-post-plugins" aria-label="Permalink to &quot;20. `... user post plugins`&quot;">​</a></h3><p>Plugins with the <a href="https://vitejs.dev/guide/api-plugin.html#plugin-ordering" target="_blank" rel="noreferrer"><code>enforce: &#39;post&#39;</code> flag</a>. For example, <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/plugin-legacy/index.js#L168" target="_blank" rel="noreferrer"><code>&#39;vite:legacy-post-process&#39;</code></a>, a sub plugin of <a href="https://github.com/vitejs/vite/tree/main/packages/plugin-legacy" target="_blank" rel="noreferrer"><code>@vitejs/plugin-legacy</code></a>, enforces this position to apply the babel in <code>renderChunk</code> after all other internal plugins have run. This plugin runs in the same position as <code>vite:esbuild-transpile</code> and <code>vite:terser</code>, replacing them to use babel for the legacy transpilation.</p><h3 id="_21-vite-build-import-analysis" tabindex="-1">21. <code>vite:build-import-analysis</code> <a class="header-anchor" href="#_21-vite-build-import-analysis" aria-label="Permalink to &quot;21. `vite:build-import-analysis`&quot;">​</a></h3><p>This plugin lexes, resolves, rewrites, and analyzes URL imports. This is the build counterpart of the dev-only <code>&#39;vite:build-import-analysis&#39;</code> plugin.</p><p><a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/importAnalysisBuild.ts#L173" target="_blank" rel="noreferrer">Dynamic imports are augmented</a> with preload directives. A <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/importAnalysisBuild.ts#L43" target="_blank" rel="noreferrer">helper</a> is <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/importAnalysisBuild.ts#L197" target="_blank" rel="noreferrer">injected in client code</a> for preloading CSS and direct imports of async chunks in parallel to the async chunk itself. See dependencies analysis to include the correct chunks to preload <a href="https://github.com/vitejs/vite/blob/3e3c20364d6c065026f7362bbcb7094099705cc9/packages/vite/src/node/plugins/importAnalysisBuild.ts#L309" target="_blank" rel="noreferrer">in the <code>generateBundle</code> hook</a>. <a href="https://vitejs.dev/guide/features.html#async-chunk-loading-optimization" target="_blank" rel="noreferrer">Async Chunk Loading Optimization</a><a href="https://github.com/vitejs/vite/blob/3e3c20364d6c065026f7362bbcb7094099705cc9/packages/vite/src/node/plugins/importAnalysisBuild.ts#L265" target="_blank" rel="noreferrer"><code>addDeps</code> implementation</a></p><p><a href="https://vitejs.dev/guide/features.html#glob-import" target="_blank" rel="noreferrer">Glob Imports</a> are identified and then transpiled using <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/importGlob.ts#L11" target="_blank" rel="noreferrer">transformImportGlob</a>. For example</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> modules</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">glob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./dir/*.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>is transformed to</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> modules</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;./dir/foo.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./dir/foo.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;./dir/bar.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./dir/bar.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/importAnalysisBuild.ts#L87" target="_blank" rel="noreferrer"><code>buildImportAnalysisPlugin</code> implementation</a>.</p><h3 id="_22-vite-esbuild-transpile" tabindex="-1">22. <code>vite:esbuild-transpile</code> <a class="header-anchor" href="#_22-vite-esbuild-transpile" aria-label="Permalink to &quot;22. `vite:esbuild-transpile`&quot;">​</a></h3><p>This plugin performs transpilation of each rendered chunk to support the configured targets, see the <a href="https://vitejs.dev/guide/build.html#browser-compatibility" target="_blank" rel="noreferrer">Browser Compatibility docs</a> and the <a href="https://vitejs.dev/config/#build-target" target="_blank" rel="noreferrer"><code>build.target</code></a> option. If <a href="https://vitejs.dev/config/#build-minify" target="_blank" rel="noreferrer"><code>build.minify</code></a> is <code>&#39;esbuild&#39;</code>, it will also use esbuild to minify the code avoiding the need of terser. See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/esbuild.ts#L208" target="_blank" rel="noreferrer"><code>buildEsbuildPlugin</code> implementation</a>. This plugin also uses the exported <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/esbuild.ts#L52" target="_blank" rel="noreferrer"><code>transformWithEsbuild</code></a> utility.</p><h3 id="_23-vite-terser" tabindex="-1">23. <code>vite:terser</code> <a class="header-anchor" href="#_23-vite-terser" aria-label="Permalink to &quot;23. `vite:terser`&quot;">​</a></h3><p>If <a href="https://vitejs.dev/config/#build-minify" target="_blank" rel="noreferrer"><code>build.minify</code></a> is <code>&#39;terser&#39;</code> (currently the default), this plugin is used to minify each rendered chunk using <code>terser</code>. Vite may <a href="https://twitter.com/youyuxi/status/1438920591646461952?s=20" target="_blank" rel="noreferrer">switch to esbuild as default soon</a> which is 20~40x faster than terser. See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/terser.ts#L6" target="_blank" rel="noreferrer"><code>terserPlugin</code> implementation</a>.</p><h3 id="_24-vite-manifest" tabindex="-1">24. <code>vite:manifest</code> <a class="header-anchor" href="#_24-vite-manifest" aria-label="Permalink to &quot;24. `vite:manifest`&quot;">​</a></h3><p>If <a href="https://vitejs.dev/config/#build-manifest" target="_blank" rel="noreferrer"><code>build.manifest</code></a> is enabled, this plugin generates a <code>manifest.json</code> file that contains a mapping of non-hashed asset filenames to their hashed versions, which can then be used by a server framework to render the correct asset links. See the <a href="https://vitejs.dev/guide/backend-integration.html" target="_blank" rel="noreferrer">Backend Integration guide</a> for more details and the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/manifest.ts#L22" target="_blank" rel="noreferrer"><code>manifestPlugin</code> implementation</a>.</p><h3 id="_25-vite-ssr-manifest" tabindex="-1">25. <code>vite:ssr-manifest</code> <a class="header-anchor" href="#_25-vite-ssr-manifest" aria-label="Permalink to &quot;25. `vite:ssr-manifest`&quot;">​</a></h3><p>If <a href="https://vitejs.dev/config/#build-ssr-manifest" target="_blank" rel="noreferrer"><code>build.ssrManifest</code></a> is enabled, this plugin is included to generate an <code>ssr-manifest.json</code> file that contains mappings of module IDs to their associated chunks and asset files. This information can be used to render preload directives for files used by async routes in SSR. See <a href="https://vitejs.dev/guide/ssr.html#generating-preload-directives" target="_blank" rel="noreferrer">Generating Preload Directives</a> for more information and the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/ssr/ssrManifestPlugin.ts#L8" target="_blank" rel="noreferrer"><code>ssrManifestPlugin</code> implementation</a>.</p><h3 id="_26-vite-reporter" tabindex="-1">26. <code>vite:reporter</code> <a class="header-anchor" href="#_26-vite-reporter" aria-label="Permalink to &quot;26. `vite:reporter`&quot;">​</a></h3><p>A plugin to log progress and a report with information about the generated chunks and assets. See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/reporter.ts#L26" target="_blank" rel="noreferrer"><code>buildReporterPlugin</code> implementation</a>.</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>$ vite build</span></span>
<span class="line"><span>vite v2.6.2 building for production...</span></span>
<span class="line"><span>✓ 34 modules transformed.</span></span>
<span class="line"><span>dist/assets/favicon.17e50649.svg   1.49 KiB</span></span>
<span class="line"><span>dist/assets/logo.ecc203fb.svg      2.61 KiB</span></span>
<span class="line"><span>dist/index.html                    0.52 KiB</span></span>
<span class="line"><span>dist/assets/index.3015a40c.js      1.39 KiB / gzip:  0.73 KiB</span></span>
<span class="line"><span>dist/assets/index.d93758c6.css     0.77 KiB / gzip:  0.49 KiB</span></span>
<span class="line"><span>dist/assets/vendor.a9c538d6.js   129.47 KiB / gzip: 41.77 KiB</span></span>
<span class="line"><span>Done in 2.90s.</span></span></code></pre></div><h3 id="_27-vite-load-fallback" tabindex="-1">27. <code>vite:load-fallback</code> <a class="header-anchor" href="#_27-vite-load-fallback" aria-label="Permalink to &quot;27. `vite:load-fallback`&quot;">​</a></h3><p>A simple plugin that provides build load fallback for arbitrary requests with queries. See the <a href="https://github.com/vitejs/vite/blob/2b7e836f84b56b5f3dc81e0f5f161a9b5f9154c0/packages/vite/src/node/plugins/loadFallback.ts#L8" target="_blank" rel="noreferrer"><code>loadFallbackPlugin</code> implementation</a>.</p><h2 id="the-vite-ecosystem" tabindex="-1">The Vite ecosystem <a class="header-anchor" href="#the-vite-ecosystem" aria-label="Permalink to &quot;The Vite ecosystem&quot;">​</a></h2><p>In this post, we are only describing the basic setup Vite. If you are using a framework, you&#39;ll include a plugin from its community that provides support for transpiling custom formats (<code>.vue</code>, <code>.svelte</code>, <code>.astro</code>), and perform further framework specific build optimizations. You&#39;ll also extend Vite&#39;s capabilities through plugins to load other file formats, comfortably work with icons, add PWA support, and so on. You can find a list of Vite community plugins in <a href="https://github.com/vitejs/awesome-vite#plugins" target="_blank" rel="noreferrer">Awesome Vite</a>, or in <a href="https://github.com/rollup/awesome#plugins" target="_blank" rel="noreferrer">Awesome Rollup</a> since most of them are <a href="https://vite-rollup-plugins.patak.dev/" target="_blank" rel="noreferrer">compatible with Vite</a>. Integrations also use Vite Javascript API as part of more complex setups that use Vite internally. There is also an increasing number of plugins implemented with <a href="https://github.com/unjs/unplugin" target="_blank" rel="noreferrer">unplugin</a>, a unified plugin system for Vite, Rollup, and Webpack. Vite build can also be used through <a href="https://vitejs.dev/guide/api-javascript.html#build" target="_blank" rel="noreferrer">Vite JavaScript API</a>, allowing integrations with more complex tools and app frameworks.</p><h2 id="closing-thoughts" tabindex="-1">Closing Thoughts <a class="header-anchor" href="#closing-thoughts" aria-label="Permalink to &quot;Closing Thoughts&quot;">​</a></h2><p>One of the keys to Vite&#39;s success has been to choose Rollup as its underlying bundler during build time. Vite offers a complete and well-tested solution out of the box for production apps. esbuild could be used in the future as an optional bundler, but at this point, it is a good call to avoid the burden on maintenance and API design needed by a more general unbundled abstraction.</p><p>Web tooling is in constant evolution. For example, there is a big push in the React community to replace babel transforms with SWC equivalents. Where it makes sense, Vite will evolve to adopt these improvements. Vite is in a position to offer a stable framework while switching to faster and simpler tools for its internals as time goes on. This is part of Vite&#39;s pragmatic philosophy when navigating tradeoffs. Vite uses the best available tools to provide a solution that is performant, solid and ready to be used today.</p><br><br><br><p><em>Last updated on 2021-10-05</em> <br> Connect with me on <a href="https://twitter.com/patak_dev" target="_blank" rel="noreferrer">Twitter</a> or in <a href="https://chat.vitejs.dev/" target="_blank" rel="noreferrer">Discord @patak</a>.</p><br><br><p><em>Continue with</em></p><p><strong><a href="./../web/vite-2.html">Vite 2</a></strong><br><em>A VitePress powered post about Vite 2 and the importance of the instant feedback loop that it enables</em></p><br><br><br><img style="filter:brightness(75%);" src="/images/vite-build-cover.jpg"><p>Cover photo from <a href="https://unsplash.com/@venczakjanos" target="_blank" rel="noreferrer">@venczakjanos</a></p></div></div></main><footer class="VPDocFooter" data-v-52e7dc14 data-v-19bb8e58><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter" data-v-be30fe8f data-v-409613f4><div class="container" data-v-409613f4><p class="message" data-v-409613f4>Released under the MIT License</p><p class="copyright" data-v-409613f4>Copyright © 2020-present Matias Capeletto</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"blog.md\":\"v2w8tYIR\",\"resources.md\":\"UBis-Lo6\",\"index.md\":\"l1IOE9lh\",\"sponsors.md\":\"Jv0E_IGN\",\"blog_open-source-at-stackblitz.md\":\"4IpFwPKy\",\"vue_history-and-persistence.md\":\"6szlPpEU\",\"vue_ignorable-watch.md\":\"9I83Z4do\",\"vite_build.md\":\"Zt_O-KJj\",\"web_vite-2.md\":\"PO43hWWY\",\"vue_mark-raw-optimization.md\":\"6tjR1827\",\"vite_ecosystem.md\":\"3kgqGdvP\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"patak\",\"description\":\"patak's home\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Blog\",\"link\":\"/blog\"}],\"sidebar\":[],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/patak-dev\"},{\"icon\":\"twitter\",\"link\":\"https://twitter.com/patak_dev\"},{\"icon\":\"mastodon\",\"link\":\"https://m.webtoo.ls/@patak\"}],\"footer\":{\"message\":\"Released under the MIT License\",\"copyright\":\"Copyright © 2020-present Matias Capeletto\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>